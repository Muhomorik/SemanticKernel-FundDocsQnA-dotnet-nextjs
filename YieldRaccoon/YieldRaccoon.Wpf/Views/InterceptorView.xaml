<UserControl
    x:Class="YieldRaccoon.Wpf.Views.InterceptorView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewModels="clr-namespace:YieldRaccoon.Wpf.ViewModels"
    d:DataContext="{d:DesignInstance viewModels:InterceptorViewModel, IsDesignTimeCreatable=False}"
    mc:Ignorable="d">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="150" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Orientation="Horizontal">
            <TextBlock
                Margin="0,0,8,0"
                VerticalAlignment="Center"
                FontFamily="Segoe Fluent Icons"
                FontSize="16"
                Text="&#xEBE8;" />
            <TextBlock
                Style="{StaticResource yr.TitleStyle}"
                Text="Network Inspector" />
        </StackPanel>

        <!-- Filter -->
        <TextBox
            Grid.Row="1"
            Margin="{StaticResource yr.ItemSpacing}"
            mah:TextBoxHelper.ClearTextButton="True"
            mah:TextBoxHelper.Watermark="Filter by URL..."
            Text="{Binding UrlFilter, UpdateSourceTrigger=PropertyChanged}" />

        <!-- Request List -->
        <DataGrid
            Grid.Row="2"
            Margin="{StaticResource yr.ItemSpacing}"
            AutoGenerateColumns="False"
            CanUserAddRows="False"
            GridLinesVisibility="Horizontal"
            HeadersVisibility="Column"
            IsReadOnly="True"
            ItemsSource="{Binding FilteredRequests}"
            SelectedItem="{Binding SelectedRequest}"
            SelectionMode="Single">
            <DataGrid.Columns>
                <DataGridTextColumn
                    Width="70"
                    Binding="{Binding Timestamp, StringFormat=HH:mm:ss}"
                    Header="Time" />
                <DataGridTextColumn
                    Width="55"
                    Binding="{Binding Method}"
                    Header="Method" />
                <DataGridTextColumn
                    Width="50"
                    Binding="{Binding StatusCode}"
                    Header="Status" />
                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding ShortUrl}"
                    Header="URL" />
            </DataGrid.Columns>
            <DataGrid.RowStyle>
                <Style BasedOn="{StaticResource MahApps.Styles.DataGridRow}" TargetType="DataGridRow">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsSuccess}" Value="True">
                            <Setter Property="Foreground" Value="{DynamicResource yr.SuccessBrush}" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding IsClientError}" Value="True">
                            <Setter Property="Foreground" Value="{DynamicResource yr.WarningBrush}" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding IsServerError}" Value="True">
                            <Setter Property="Foreground" Value="{DynamicResource yr.ErrorBrush}" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>
        </DataGrid>

        <!-- Action buttons -->
        <StackPanel
            Grid.Row="3"
            Margin="{StaticResource yr.ItemSpacing}"
            Orientation="Horizontal">
            <Button
                Width="60"
                Command="{Binding ClearRequestsCommand}"
                Content="Clear"
                Style="{StaticResource yr.ButtonFlatStyle}" />
            <Button
                Width="75"
                Margin="8,0,0,0"
                Command="{Binding CopyUrlCommand}"
                Content="Copy URL"
                Style="{StaticResource yr.ButtonFlatStyle}" />
            <Button
                Width="100"
                Margin="8,0,0,0"
                Command="{Binding CopyResponseCommand}"
                Content="Copy Response"
                Style="{StaticResource yr.ButtonFlatStyle}" />
        </StackPanel>

        <!-- Response Preview -->
        <Border
            Grid.Row="4"
            Margin="{StaticResource yr.ItemSpacing}"
            Style="{StaticResource yr.PanelControlStyle}">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                <TextBox
                    AcceptsReturn="True"
                    Background="Transparent"
                    BorderThickness="0"
                    FontFamily="Consolas"
                    FontSize="11"
                    IsReadOnly="True"
                    Text="{Binding SelectedRequest.ResponsePreview, Mode=OneWay}"
                    TextWrapping="Wrap" />
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>
